(function(){function w(){return!1}function x(){return!0}function y(a){return"object"==typeof a&&3===P(a)&&!a.nodeType&&a.constructor===Object}function E(a){return!0===a||!1===a}function H(a,b,c,d){return setTimeout(function(){a.apply(b,c||[])},d||0)}function Q(){}var r=Array.prototype.slice,R=Object.prototype.toString,P=function(){var a={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};
return function(b){if(!b){if(null===b)return 6;if(void 0===b)return 7}var c=a[R.call(b)];return void 0===c?-1:1===c&&isNaN(b)?8:c}}(),p=function(){return function b(){var c=!1,d=!1,f=r.call(arguments),g=f.shift(),e,n,h;E(f[f.length-1])&&(c=f.pop());E(f[f.length-1])&&(d=c,c=f.pop());for(;f.length;)if((e=f.shift())&&e.hasOwnProperty)for(n in e)if(e.hasOwnProperty(n)&&void 0!==(h=e[n]))if(d)if(g[n]&&y(g[n])&&y(h))b(g[n],h,c,d);else{if(!0===c||void 0==g[n])y(h)?(g[n]={},b(g[n],h,c,!0)):g[n]=h}else if(!0===
c||void 0==g[n])g[n]=h;return g}}(),D=function(a){if(a instanceof D)return a;if(!(this instanceof D))return new D(a);for(var b in a)if(!this[b])try{this[b]=a[b]}catch(f){}this.originalEvent=a;this.type=a.type;!this.target&&a.srcElement&&(this.target=a.srcElement);var c=a.button;if(void 0===this.pageX&&null!==a.clientX){var d=this.target?this.target.ownerDocument||window.document:window.document;b=d.documentElement;d=d.body;this.pageX=a.clientX+(b&&b.scrollLeft||d&&d.scrollLeft||0)-(b&&b.clientLeft||
d&&d.clientLeft||0);this.pageY=a.clientY+(b&&b.scrollTop||d&&d.scrollTop||0)-(b&&b.clientTop||d&&d.clientTop||0)}this.which||void 0===c||(this.which=c&1?1:c&2?3:c&4?2:0);this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?x:w;this.timeStamp=a&&a.timeStamp||(new Date).getTime()};p(D.prototype,{isDefaultPrevented:w,isPropagationStopped:w,isImmediatePropagationStopped:w,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=x;a.returnValue=
!1;a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=x;a.cancelBubble=!0;a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=x;a&&a.stopImmediatePropagation&&a.stopImmediatePropagation();this.stopPropagation()}},!0,!1);var N=function(a){function b(){d=null}var c,d;a=function(a){return function(f){var e=new D(f||window.event),g=r.call(arguments,
1),h=0,l=0,k=0,m=0;e.type="mousewheel";"detail"in e&&(l=-1*e.detail);"wheelDelta"in e&&(l=e.wheelDelta);"wheelDeltaY"in e&&(l=e.wheelDeltaY);"wheelDeltaX"in e&&(h=-1*e.wheelDeltaX);"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(h=-1*l,l=0);var q=0===l?h:l;"deltaY"in e&&(q=l=-1*e.deltaY);"deltaX"in e&&(h=e.deltaX,0===l&&(q=-1*h));if(0!==l||0!==h){var t=Math.max(Math.abs(l),Math.abs(h));if(!d||t<d)d=t,"mousewheel"===e.type&&0===t%120&&(d/=40);"mousewheel"===e.type&&0===t%120&&(q/=40,h/=40,l/=40);q=Math[1<=
q?"floor":"ceil"](q/d);h=Math[1<=h?"floor":"ceil"](h/d);l=Math[1<=l?"floor":"ceil"](l/d);this.getBoundingClientRect&&(t=this.getBoundingClientRect(),k=e.clientX-t.left,m=e.clientY-t.top);e.deltaX=h;e.deltaY=l;e.deltaFactor=d;e.offsetX=k;e.offsetY=m;e.deltaMode=0;g.unshift(e,q,h,l);c&&clearTimeout(c);c=setTimeout(b,200);return a.apply(this,g)}}};a.events=function(){var a=window.document;return"onwheel"in a||9<=a.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"]};return a}(),
F=function(){var a=null,b=null;return function(c,d,f){null===a&&(c.addEventListener?(a="addEventListener",b=""):(a="attachEvent",b="on"));if("mousewheel"==d){f=N(f);d=N.events();var g;var e=0;for(g=d.length;e<g;e++)c[a](b+d[e],f,!1)}else c[a](b+d,f,!1);return f}}(),S=Function.prototype.bind?function(a,b){return a.bind(b)}:function(a,b){return function(){return a.apply(b,arguments)}},I=function(){var a=["0","0","0"];return function(){for(var b=a.length,c;b;){b--;c=a[b].charCodeAt(0);if(57==c)return a[b]=
"A",a.join("");if(90==c)a[b]="0";else return a[b]=String.fromCharCode(c+1),a.join("")}a.unshift("0");return a.join("")}}(),z=function(a,b){this.name=a;this.listeners=[];this.map={};this.hash=I();this.uni="$$"+a+"_"+this.hash;this.suspended=!1;this.lid=0;"object"===typeof b&&null!==b?p(this,b,!0,!1):this.returnResult=b};p(z.prototype,{name:null,listeners:null,map:null,hash:null,uni:null,suspended:!1,lid:null,returnResult:null,autoTrigger:null,lastTrigger:null,triggerFilter:null,filterContext:null,
expectPromises:!1,resolvePromises:!1,getName:function(){return this.name},destroy:function(){for(var a in this)this[a]=null},on:function(a,b,c){if(!a)return null;b=b||null;c=c||{};var d=this.uni,f=a||b;if(f[d]&&!c.allowDupes)return null;var g=++this.lid,e=c.first||!1;f[d]=g;a={fn:a,context:b,uniContext:f,id:g,async:!1,called:0,limit:0,start:1,count:0,append:null,prepend:null};p(a,c,!0,!1);!0===a.async&&(a.async=1);e?this.listeners.unshift(a):this.listeners.push(a);this.map[g]=a;if(this.autoTrigger&&
this.lastTrigger&&!this.suspended){var n=this.triggerFilter;this.triggerFilter=function(a){return a.id===g?n?!1!==n(a):!0:!1};this.trigger.apply(this,this.lastTrigger);this.triggerFilter=n}return g},once:function(a,b,c){c=c||{};c.limit=1;return this.on(a,b,c)},un:function(a,b){var c=-1,d=this.uni,f=this.listeners;a=a==parseInt(a)?parseInt(a):(b||a)[d];if(!a)return!1;b=0;for(var g=f.length;b<g;b++)if(f[b].id===a){c=b;delete f[b].uniContext[d];break}if(-1===c)return!1;f.splice(c,1);delete this.map[a];
return!0},hasListener:function(a,b){var c=this.listeners;if(a){b=b||a;a="function"!=typeof a?parseInt(a):b[this.uni];if(!a)return!1;b=0;for(var d=c.length;b<d;b++)if(c[b].id===a)return!0;return!1}return 0<c.length},removeAllListeners:function(){var a=this.listeners,b=this.uni,c;var d=0;for(c=a.length;d<c;d++)delete a[d].uniContext[b];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(a,b){if(a.append||a.prepend)b=r.call(b),
a.prepend&&(b=a.prepend.concat(b)),a.append&&(b=b.concat(a.append));return b},trigger:function(){var a=this,b=a.listeners,c=a.returnResult,d=a.triggerFilter,f=a.filterContext,g=a.expectPromises,e=[],n;if(a.suspended)return null;a.autoTrigger&&(a.lastTrigger=r.call(arguments));if(0===b.length)return null;var h="all"===c||"concat"===c?[]:"merge"===c?{}:null,l,k;for(l="first"===c?[b[0]]:r.call(b);k=l.shift();)if(!(!k||!a.map[k.id]||(b=a._prepareArgs(k,arguments),d&&!1===d.call(f,k,b,a))||k.filter&&!1===
k.filter.apply(k.filterContext||k.context,b)||(k.count++,k.count<k.start))){if(k.async&&!g){var m=null;H(k.fn,k.context,b,k.async)}else g?(m=function(b,c,d){return function(e){"pipe"===c&&(d[0]=e,d=a._prepareArgs(b,d));return b.fn.apply(b.context,d)}}(k,c,r.call(arguments)),m=n?n.then(m):k.fn.apply(k.context,b),m.catch(function(a){console.log(a)})):m=k.fn.apply(k.context,b);k.called++;k.called===k.limit&&a.un(k.id);if("first"===c)return m;if(g)e.push(m),"pipe"===c&&m&&(n=m);else if(null!==c)if("all"===
c)h.push(m);else if("concat"===c&&m)h=h.concat(m);else if("merge"===c)p(h,m,!0,!1);else{if("nonempty"===c&&m)return m;if("pipe"===c)h=m,arguments[0]=m;else if("last"===c)h=m;else{if(!1===c&&!1===m)return!1;if(!0===c&&!0===m)return!0}}}return g?(d=Promise.all(e),a.resolvePromises&&null!==c&&"all"!==c&&(d=d.then(function(a){var b,d=a.length;for(b=0;b<d;b++){var e=a[b];if("concat"===c&&e)h=h.concat(e);else if("merge"===c)p(h,e,!0,!1);else{if("nonempty"===c&&e)return e;if(!1===c&&!1===e)return!1;if(!0===
c&&!0===e)return!0}}return h})),d):h}},!0,!1);var O=function(){this.events={}};p(O.prototype,{createEvent:function(a,b){a=a.toLowerCase();var c=this.events;c[a]||(c[a]=new z(a,b));return c[a]},getEvent:function(a){a=a.toLowerCase();return this.events[a]},on:function(a,b,c,d){a=a.toLowerCase();var f=this.events;f[a]||(f[a]=new z(a));return f[a].on(b,c,d)},once:function(a,b,c,d){d=d||{};d.limit=1;return this.on(a,b,c,d)},un:function(a,b,c){a=a.toLowerCase();var d=this.events;d[a]&&d[a].un(b,c)},relayEvent:function(a,
b){a.on(b,this.trigger,this,{prepend:"*"===b?null:[b]})},unrelayEvent:function(a,b){a.un(b,this.trigger,this)},hasListener:function(a,b,c){var d=this.events;if(a)return a=a.toLowerCase(),d[a]?b?d[a].hasListener(b,c):!0:!1;for(a in d)if(d[a].hasListener())return!0;return!1},hasEvent:function(a){return!!this.events[a]},removeAllListeners:function(a){var b=this.events;if(a)b[a]&&b[a].removeAllListeners();else for(a in b)b[a].removeAllListeners()},trigger:function(){var a=arguments[0],b=this.events,c=
null;a=a.toLowerCase();if(b[a]){var d=b[a];c=d.trigger.apply(d,r.call(arguments,1))}(d=b["*"])&&d.trigger.apply(d,arguments);return c},suspendEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].suspend()},suspendAllEvents:function(){var a=this.events,b;for(b in a)a[b].suspend()},resumeEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].resume()},resumeAllEvents:function(){var a=this.events,b;for(b in a)a[b].resume()},destroyEvent:function(a){var b=this.events;b[a]&&(b[a].removeAllListeners(),
b[a].destroy(),delete b[a])},destroy:function(){var a=this.events,b;for(b in a)this.destroyEvent(b);for(b in this)this[b]=null},getApi:function(){if(!this.api){for(var a="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent relayEvent unrelayEvent".split(" "),b={},c,d=-1,f=a.length;++d<f;c=a[d],b[c]=S(this[c],this));this.api=b}return this.api}},!0,!1);var T=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?::([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?::([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,
u=function(a){var b=a.match(T)||[],c=("undefined"!=typeof window?window.location:null)||{};return{protocol:b[4]||c.protocol||"http:",hostname:b[11]||c.hostname||"",host:(b[11]||"")+(b[12]?":"+b[12]:"")||c.host||"",username:b[8]||c.username||"",password:b[9]||c.password||"",port:parseInt(b[12],10)||c.port||"",href:a,path:(b[13]||"/")+(b[16]||""),pathname:b[13]||"/",search:b[16]||"",hash:b[17]&&"#"!=b[17]?b[17]:""}},J=function(a,b){var c="";b=b||{};b.onlyPath||(c+=a.protocol+"//",a.username&&a.password&&
(c+=a.username+":"+a.password+"@"),c+=a.hostname,a.hostname&&a.port&&(c+=":"+a.port));b.onlyHost||(c+=a.pathname||"/",a.search&&"?"!=a.search&&(c+=a.search),a.hash&&"#"!=a.hash&&(c+=a.hash));return c},U=function(){var a,b,c,d=new O,f=I(),g="$$"+f,e=I(),n=new RegExp("#"+f+"=([A-Z0-9]+)"),h,l,k="undefined"==typeof window,m=null,q,t,r;d.createEvent("before-location-change",!1);d.createEvent("void-click",!1);var w=function(a){a=a||{};a[g]||(a[g]=I());e=a[g];return a},x=function(a){a=a||{};a[g]||(a[g]=
e);return a},y=function(a,b){"string"==typeof a&&(a=u(a));"string"==typeof b&&(b=u(b));var c=["protocol","host","port"],d;var K=0;for(d=c.length;K<d;K++){var e=c[K];if(a[e]&&b[e]&&a[e]!=b[e])return!0}return!1},z=function(a,b){"string"==typeof a&&(a=u(a));"string"==typeof b&&(b=u(b));return y(a,b)||a.pathname!=b.pathname||a.search!=b.search||a.hash!=b.hash},A=function(a){a=u(a);return!q||r?a.path:J(a,{onlyPath:!0})},C=function(a){var b=null;a=a.replace(n,function(a,c){b=c;return""});return{hash:a,
id:b}},L=function(a,b){a?("#"!=a.substr(0,1)&&(a=C(a).hash,a="!"+a+"#"+f+"="+e),c.hash=a):c.hash=""},G=function(){if(q)var a=J(c);else{a=c.hash.substr(1);var b=p({},c,!0,!1);a&&(a=C(a).hash,"!"==a.substr(0,1)&&(a=a.substr(1)),a=decodeURIComponent(a).split("?"),b.pathname=a[0],b.search=a[1]?"?"+a[1]:"");a=J(b)}return a},E=function(a){m=p({},c,!0,!1);v("location-change",a)},M=function(){if(z(m,c)){var a=G();v("before-location-pop",a);e=q?b.state?b.state[g]:null:C(c.hash).id;m=p({},c,!0,!1);v("location-change",
a)}},v=function(a,b,c){b=b||G();var e=u(b);return d.trigger(a,e.pathname+e.search+e.hash,c,b)},B=function(){a=window;b=a.history;c=a.location;q=!!b.pushState;t="onhashchange"in a;r=!1;m=p({},c,!0,!1);if(q)F(a,"popstate",M),h=function(a,c,d){if(!1===v("before-location-change",a,c))return!1;b.pushState(w(d),null,A(a));E(a)},l=function(a,c,d){b.replaceState(x(d),null,A(a));E(a)},l(G());else if(t)h=function(a,b,c){if(!1===v("before-location-change",a,b))return!1;H(L,null,[A(a),w(c)])},l=function(a,b,
c){H(L,null,[A(a),x(c)])},F(a,"hashchange",M);else{var e=null,f=!1;a.onIframeHistoryChange=function(a){f||H(function(){L(a);M()})};var g=function(a){var b=e.contentDocument?e.contentDocument:e.contentWindow.document;b.open();b.write("<html><head><title>"+document.title+'</title><script type="text/javascript">var hashValue = "'+a+'";window.top.onIframeHistoryChange(hashValue);\x3c/script></head><body>&nbsp;</body></html>');b.close()};h=function(a,b,c){if(!1===v("before-location-change",a,b))return!1;
g(A(a))};l=function(a,b,c){if(!1===v("before-location-change",a,b))return!1;e.contentWindow.hashValue=A(a)};var n=function(){e=window.document.createElement("iframe");e.src="about:blank";e.style.display="none";window.document.body.appendChild(e);f=!0;g(A(c.hash.substr(1)));f=!1};k?n():F(a,"load",n)}F(window.document.documentElement,"click",function(b){b=new D(b||a.event);for(var e=b.target,f;e&&"a"!=e.nodeName.toLowerCase();)e=e.parentNode;if(e&&!b.isDefaultPrevented()){f=e.getAttribute?e.getAttribute("href"):
null;if("#"==f&&!d.trigger("void-click",e))return b.preventDefault(),b.stopPropagation(),!1;if(f&&"#"!=f.substr(0,1)&&(!e.getAttribute||!e.getAttribute("target"))){var g=p({},c,!0,!1),k=u(f);if(y(g,k))return null;z(g,k)?h(f,e):v("same-location",null,e);b.preventDefault();b.stopPropagation();return!1}}return null});B=Q};F(window,"load",function(){k=!0});return p({},d.getApi(),{push:function(a,b){B();var d=p({},c,!0,!1),e=u(a);if(y(d,e))return null;z(d,e)&&h(a,null,b)},replace:function(a,b){B();l(a,
null,b)},saveState:function(a){B();l(G(),null,a)},mergeState:function(a){this.saveState(p({},b.state,a,!0,!1))},getState:function(){return b.state},getCurrentStateId:function(){return e},current:function(){B();return G()},init:function(){return B()},polyfill:function(){B();window.history.pushState=function(a,b,c){h(c,null,a)};window.history.replaceState=function(a,b,c){l(c,null,a)}}})}(),C={};C.history=U;"undefined"!=typeof global?global.MetaphorJs=C:window.MetaphorJs=C})();
